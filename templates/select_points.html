<!doctype html>
<html>
  <body>
    <h3>Select Start then Goal</h3>
    <p>Click once for Start (magenta), then once for Goal (yellow). Coordinates shown below.</p>
    <canvas id="cnv"></canvas>
    <div id="coords">Start: -, Goal: -</div>
    <form id="goForm" method="post" action="/start">
      <input type="hidden" name="jobId" value="{jobId}">
      <input type="hidden" name="startY" id="startY">
      <input type="hidden" name="startX" id="startX">
      <input type="hidden" name="goalY" id="goalY">
      <input type="hidden" name="goalX" id="goalX">
      <label>Expansions per frame: <input type="number" name="expansionsPerFrame" value="25" min="1" max="200"></label>
      <button type="submit">Run</button>
    </form>
    <script>
      const jobId = "{jobId}";
      const imgUrl = "/image/" + jobId + "/base.png";
      const cnv = document.getElementById("cnv");
      const ctx = cnv.getContext("2d");
      const coordsDiv = document.getElementById("coords");
      const startY = document.getElementById("startY");
      const startX = document.getElementById("startX");
      const goalY = document.getElementById("goalY");
      const goalX = document.getElementById("goalX");
      let clicks = [];
      const img = new Image();
      img.onload = () => {{ cnv.width = img.width; cnv.height = img.height; ctx.drawImage(img,0,0); }};
      img.src = imgUrl;

      function drawMarkers() {{
        ctx.drawImage(img,0,0);
        if (clicks[0]) {{
          ctx.fillStyle = "magenta";
          ctx.fillRect(clicks[0].x-2, clicks[0].y-2, 5, 5);
        }}
        if (clicks[1]) {{
          ctx.fillStyle = "yellow";
          ctx.fillRect(clicks[1].x-2, clicks[1].y-2, 5, 5);
        }}
      }}
      cnv.addEventListener("click", (e) => {{
        const rect = cnv.getBoundingClientRect();
        const x = Math.round(e.clientX - rect.left);
        const y = Math.round(e.clientY - rect.top);
        if (clicks.length < 2) {{ clicks.push({{x, y}}); }} else {{ clicks = [{{x, y}}]; }}
        drawMarkers();
        if (clicks[0]) {{ startY.value = clicks[0].y; startX.value = clicks[0].x; }}
        if (clicks[1]) {{ goalY.value = clicks[1].y; goalX.value = clicks[1].x; }}
        coordsDiv.textContent = "Start: " + (clicks[0] ? clicks[0].y + "," + clicks[0].x : "-") +
                                " | Goal: " + (clicks[1] ? clicks[1].y + "," + clicks[1].x : "-");
      }});
    </script>
  </body>
</html>